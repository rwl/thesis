\chapter{Background}
\label{ch:background}
This chapter provides an introduction to electricity supply and wholesale
electricity markets in the UK.  It explains how electricity markets can be
simulated and how the power system dynamics are captured in the associated
models.

\section{Electric Power Supply}

\input{tikz/structure}

Generation and bulk movement of electricity in the UK takes place in a
three-phase alternating current (AC) power system.  These phases are
high voltage, sinusoidal electrical waveforms, offset in time from each
other by 120 degrees and oscillating at a frequency of almost exactly 50Hz.
Synchronous generators (or alternators), typically rotating at 3600rpm or
1800rpm, generate apparent power $S$ at a line voltage $V_l$, typically
between 11kV and 25kV.  One of the principal reasons that alternating current,
and not direct current (DC), systems are common in electricity supply is that
they allow power to be transformed between voltages with very high efficiency.
The apparent power conducted by a three-phase transmission line $l$ is the
product of the line current $I_l$ and the line voltage
\begin{equation}
S = \sqrt{3} V_l I_l .
\end{equation}
For a constant quantity of transmitted power, increasing the line voltage has
an inverse effect on the line current.  Ohmic heating losses are proportional to the
square of line current
\begin{equation}
P_{r} = 3 I_l^2 R
\end{equation}
where $R$ is the resistance of the transmission line.  Hence reducing the line
current causes a large reduction in energy wasted through heating losses.  A
consequence of higher voltages is the larger extent and integrity of the
insulation required between conductors, neutral and earth.  This results in
the need for large transmission towers and in high cable costs when
undergrounding systems.

The UK transmission system operates at 400kV and 275kV (also 132kV in
Scotland), but systems with voltages upto and beyond 1000kV are used in
larger countries.  For transmission over very long distances or
undersea, high voltage DC (HVDC) systems have become economically viable in
recent years.  The ability to
transform power between voltages and transmit large volumes over long
distances allows for generation to take place at high capacity power stations,
which offer economies of scale and lower operating costs. It allows electricity to
be transmitted across country borders and from renewable energy plant such as
hydro power stations located in remote areas.  A HVDC interconnector between
Folkstone in the UK and Sangatte in France allows upto 2GW of
electricity to be imported/exported.  The Moyle HVDC interconnector can export
upto 500MW from Auchencrosh in Scotland to Ballycronan More in Northern
Ireland or import upto 80MW.  Further HVDC interconnectors are planned between
England and the Netherlands and between Wales and The Republic of Ireland.
Figure \ref{fig:uk_gen} diagrams the existing interconnectors and illustrates
how the UK's larger power stations are located away from large load centres and
close to sources of fuel.

\input{tikz/uk}

For delivery to most consumers, electric energy is transferred, at a
substation, from the transmission system to the grid supply point of a distribution
system.  Distribution networks are also three-phase AC power systems, but
typically operate at lower voltages and differ in their general
structure or topology from transmission networks.  Transmission networks are
typically highly interconnected, providing multiple paths for power flow.
Whereas distribution networks, in rural areas, typically consist of long radial
feeders (usually overhead lines) or, in urban areas, consist of many ring
circuits.  Three-phase transformers, that step the voltage down to levels
more convenient for general use (typically from 11kV or 33kV to 400V), are
spaced along the branches/rings. All three-phases at 400V may be provided for
industrial and commercial loads or individual phases at 230V supply typical
domestic and other commercial loads. Splitting of phases is usually planned so
that each is loaded equally. This produces a balanced, symmetrical system that
may be analysed, as explained in Section \ref{sec:pf_form}, as a
\textit{single} phase circuit.  Figure \ref{fig:powersystem} illustrates the
basic structure of a typical national electric power system.

\section{Electricity Markets}
The UK was the first large country to privatise its electricity supply industry
when it did so in the early 1990s.  The approach has been used as a model
by other countries and the market structures implemented in the UK have used
most of the main concepts available in national electricity market design.

The England and Wales Electricity Pool was created in 1990 to break up the
vertically integrated Central Electricity Generating Board (CEGB) and
gradually introduce competition in generation and retail supply.  Early
adoption of electricity markets by the UK has lead to the country hosting many
of the main European power and gas exchanges and the UK boasts a high degree
of consumer switching, an important factor in any competitive marketplace.  The
Pool has since been replaced by trading arrangements in which market outcomes
are not centrally determined, but arise largely from bilateral agreements
between producers and suppliers.

\subsection{The England and Wales Electricity Pool}
\label{sec:thepool}
The Electric Lighting Act 1882 began the development of the UK's electricity
supply industry by allowing persons, companies and local authorities to set up
supply systems, principally at the time for the purposes of street lighting and
trams.  Under The Electricity Supply Act 1926 the Central Electricity Board
started operating the first grid of regional networks interconnected and
synchronised at 132kV, 50Hz in 1933.  This began operation as a national system
five years later in 1938 and was nationalised under The Electricity Act 1947
with the merger of over 600 electricity companies and the creation of the
British Electricity Authority.  This was dissolved and replaced with the
CEGB and the Electricity Council under The Electricity Act 1957.  The CEGB was
responsible for planning the network and generating sufficient electricity until the start of privatisation in 1990.

The UK electricity supply industry was privatised under Prime Minister
Margaret Thatcher and The England and Wales Electricity Pool was created in
March 1990.  Control of the transmission system was transferred from the
CEGB to The National Grid Company, which was originally owned by twelve
regional electricity companies and has since become publicly listed.  The
Pool was a multilateral contractual arrangement between generators and suppliers and did
not itself buy or sell electricity.  Competition in generation was introduced
gradually, by first entitling customers with consumption greater than or equal
to 1MW (approximately 45\% of the non-domestic market \cite{decc:dukes09}) to
purchase electricity form any listed supplier.  This limit was lowered in April
1994 to included customers with peak loads of 100kW or more.  Finally, between
September 1998 and March 1999 the market was opened to all customers.

Scheduling of generation was on a merit order basis (cheapest first) at a day
ahead stage and set a wholesale electricity price for each half-hour period of
the schedule day.  Forecasts of total demand in MW, based on historic data and
adjusted for factors such as the weather, for each settlement period were used
by generating companies and organisations with interconnects to the England
and Wales grid to formulate bids that had to be submitted to the grid operator
by 10AM on the day before the schedule day.

\input{tikz/cost_function}

Figure \ref{fig:poolbids} diagrams four of the five price parameters
that made up a bid.  A start-up price would also be stated, representing the
cost of turning on the generator from cold.  The no-load price $c_{noload}$
represents the cost in pounds of keeping the generator running regardless of output. Three
incremental prices $c_1$, $c_2$ and $c_3$ specify the cost in \pounds/MWh of
generation between set-points $p_1$, $p_2$ and $p_3$.

A settlement computer program would calculate an unconstrained schedule
(with no account being taken for the physical limitations of the transmission
system), meeting the forecast demand and requirements for reserve while minimising cost.
Cheapest bids up to the marginal point would get accepted first and the bid
price from the marginal generator would generally determine the system marginal
price for each settlement period.  The system marginal price would determine
the prices paid by consumers and paid to generators, which would be adjusted
such that that the costs of transmission are covered by the market and that the
availability of capacity is encouraged at certain times.

Variations in demand and changes in plant availability got adjusted for by
the grid operator, producing a constrained schedule.  Generators having
submitted bids would be instructed to increase or reduce production
appropriately.  Alternatively, the grid operator could instruct large customers
with contracts to curtail their demand to do so or instruct generators
contracted to provide ancillary services to adjust production.

\subsection{British Electricity Transmission and Trading Arrangements}
%\subsection{New Electricity Trading Arragements}
\label{sec:betta}
Concerns over exploitation of market power in The England and Wales Electricity
Pool and its effectiveness in reducing consumer electricity prices prompted the
introduction of New Electricity Trading Arrangements (NETA) in March 2001
\cite{martoccia:2005}.  The aim was to improve efficiency and provide greater
choice to participants.  Control of the Scottish transmission system was
handed over to England with the introduction of the nationwide British
Electricity Transmission and Trading Arrangements (BETTA) in April 2005 under
The Energy Act 2004.  While The Pool operated a single daily auction and dispatched plant
centrally, under the new arrangements participants became self-dispatching and
market positions became determined through continuous bilateral trading
between generators, suppliers, traders and consumers.

The majority of power is traded under the BETTA through long-term contracts
that are customised to the requirements of each party \cite{kirschen:book}.
These suit participants responsible for large power plants or those purchasing
large volumes of power for many customers.  Sizeable amounts of time and
effort are required for these long-term contracts to be formed and this results
in a high associated transaction cost.  However, they reduce risk for large
players and a degree of flexibility can be provided through option contracts.

Electric power is also traded directly between participants through
over-the-counter contracts that are usually of a standardised form.  Such contracts
typically concern smaller volumes of power and have much lower associated
transaction costs.  Often they are used by participants to refine their market
position ahead of delivery time.

Trading facilities, such as power exchanges, provide a means for participants
to fine-tune their positions further, through short-term transactions for
relatively small quantities of energy.  Modern exchanges are computerised and
accept anonymous offers and bids submitted electronically.  A submitted
offer/bid will be paired with any outstanding bids/offers in the system with
compatible price and quantity values.  The details are then displayed for
traders to observe and to use in subsequent trading.

All bilateral trading must be completed before ``gate-closure'' which is a
point in time, before delivery time, that gives the system operator an
opportunity to balance supply and demand and mitigate potential breaches of
system limits.  In keeping with the UK's free market philosophy, a competitive
spot market \cite{schweppe:spot} is used in the balancing process.  A
generator that is not fully loaded may offer a price at which it is willing to
increase its output by a specified quantity, stating the rate at which it is
capable of doing so.  Certain loads may also offer demand reductions at a
price which can typically be implemented very quickly.  Longer-term contracts
for balancing services are also struck between the system operator and
generators/suppliers in order to avoid the price volatility often associated
with spot markets.

\section{Electricity Market Simulation}
Previous sections have shown the importance of electricity to
modern societies and have explained how the majority of
electricity supply in the UK is trusted to unadministered bilateral trading
arrangements. Electricity supply involves technology, money, people, natural resources and the environment.  These aspects are all changing
and the discipline must be constantly researched to ensure that systems such as
electricity markets are fit for purpose.  The value of electricity to society
means that it is not feasible to experiment with radical changes to trading
arrangements on real systems.  A practical alternative is to create abstract
mathematical models with sets of simplifying approximations and assumptions
and to find analytical solutions by simulating them using computer programs.

Game theory is the branch of applied mathematics in which behaviour in
strategic situations is captured mathematically.  A common approach to doing
this is to model the system and players as a mathematical optimisation problem.  Optimal
power flow is a classic optimisation problem in the field of electric
power engineering and variants are widely used to research electricity
markets.  In this thesis, optimal power flow forms one part of an
\textit{agent-based} simulation, which is an alternative approach to the
mathematics of games.

\subsection{Optimal Power Flow}
\label{sec:opf}
Nationalised electricity supply industries were for many years planned,
operated and controlled centrally.  A system operator would determine which
generators must operate and the required output of the operating units such
that demand and reserve requirements were met and the overall cost of
production was minimised.  In Electric Power Engineering, this is termed the
\textit{unit commitment} and \textit{economic dispatch} problem.

In 1962 a unit commitment formulation was published with power system
constraints incorporated \cite{carpentier:opf}.  \textit{Optimal power flow} is
this integration of the economic and the power flow aspects of power systems into a
mathematical optimisation problem.  The ability to use optimal power flow to
solve centralised power system operation problems and determine prices in power
pool markets has led to it being one of the most widely studied subjects in
the power systems community.

\subsubsection{Power Flow Formulation}
\label{sec:pf_form}
Optimal power flow derives its name from the \textit{power flow} (or load flow)
steady-state power system analysis technique.  Given sets of generator data,
load data and a nodal admittance matrix, a power flow study determines the
voltage
\begin{equation}
V_i = \vert V_i \vert \angle\delta_i = \vert
V_i\vert(\cos\delta_i + j\sin\delta_i)
\end{equation}
at each node $i$ in the power system from which branch flows may be calculated
\cite{grainger:psa}.

\paragraph{Nodal Admittance Matrix}
The nodal admittance matrix describes the electrical network and its
formulation is dependant upon the transmission line, transformer and shunt
models employed.  Following \citeA[p.11]{pserc:mp_manual}, a branch in a power
system nodal representation is typically modelled as a medium length
transmission line in series with a regulating transformer at the ``from'' end.
A nominal-$\pi$ model with total series admittance $y_s = 1/(r_s+jx_s)$ and
total shunt capacitance $b_c$ represents the transmission line.  The
transformer is assumed to be ideal, phase-shifting and tap-changing, with the
ratio between primary winding voltage $v_{f}$ and secondary winding voltage
$N = \tau e^{j\theta_{ph}}$ where $\tau$ is the tap ratio and $\theta_{ph}$ is
the phase shift angle. Figure \ref{fig:branch_model} diagrams this
conventional branch model.  From Kirchhoff's Current Law the current in the
series impedance is
\begin{equation}
\label{eq:iseries}
i_s = \frac{b_c}{2}v_t - i_t
\end{equation}
and from Kirchhoff's Voltage Law the voltage across the secondary winding of
the transformer is
\begin{equation}
\frac{v_{f}}{N} = v_t + \frac{i_s}{y_s}
\end{equation}
Substituting $i_s$ from equation (\ref{eq:iseries}), gives
\begin{equation}
\label{eq:vfrom}
\frac{v_{f}}{N} = v_t - \frac{i_t}{y_s} + v_t\frac{b_c}{2y_s}
\end{equation}
and rearranging in terms if $i_t$, gives
\begin{equation}
\label{eq:ito}
i_t = v_s \left( \frac{-y_s}{\tau e^{\theta_{ph}}} \right) +
v_r \left( y_s + \frac{b_c}{2} \right)
\end{equation}
The current through the secondary winding of the transformer is
\begin{equation}
N^*i_f = i_s + \frac{b_c}{2}\frac{v_{f}}{N}
\end{equation}
Substituting $i_s$ from equation(\ref{eq:iseries}) again, gives
\begin{equation}
N^*i_f = \frac{b_c}{2}v_t - i_t + \frac{b_c}{2}\frac{v_{f}}{N}
\end{equation}
and substituting $\frac{v_{f}}{N}$ from equation (\ref{eq:vfrom}) and
rearranging, gives
\begin{equation}
\label{eq:ifrom}
i_s = v_s \left( \frac{1}{\tau^2} \left(y_s + \frac{b_c}{2}\right) \right) +
v_r \left(\frac{y_s}{\tau e^{-j\theta}}\right)
\end{equation}

\input{tikz/branch_model}

Combining equations (\ref{eq:ito}) and (\ref{eq:ifrom}), the \textit{from}
and \textit{to} end complex current injections for branch $l$ are
\begin{equation}
\label{eq:ybranch}
\begin{bmatrix}
i_f^l\\
i_t^l
\end{bmatrix}
=
\begin{bmatrix}
y_{ff}^l& y_{ft}^l\\
y_{tf}^l& y_{tt}^l
\end{bmatrix}
\begin{bmatrix}
v_f^l\\
v_t^l
\end{bmatrix}
\end{equation}
where
\begin{eqnarray}
\label{eq:yff}
y_{ff}^l& =& \frac{1}{\tau^2} \left(y_s + \frac{b_c}{2}\right)\\
\label{eq:yft}
y_{ft}^l& =& \frac{y_s}{\tau e^{-j\theta_{ph}}}\\
\label{eq:ytf}
y_{tf}^l& =& \frac{-y_s}{\tau e^{j\theta_{ph}}}\\
\label{eq:ytt}
y_{tt}^l& =& y_s + \frac{b_c}{2}
\end{eqnarray}
Let $Y_{ff}$, $Y_{ft}$, $Y_{tf}$ and $Y_{tt}$ be $n_l \times 1$ vectors where
the $l^{th}$ element of each corresponds to $y_{ff}^l$, $y_{ft}^l$,
$y_{tf}^l$ and $y_{tt}^l$, respectively.  Furthermore, let $C_f$ and $C_t$ be the
$n_l \times n_b$ branch-bus connection matrices, where $C_{f_{i,j}} = 1$ and
$C_{t_{i,k}} = 1$ if branch $i$ connects from bus $j$ to bus $k$.  The
$n_l \times n_b$ branch admittance matrices are
\begin{eqnarray}
Y_f& =& \diag(Y_{ff})C_f + \diag(Y_{ft})C_t\\
Y_t& =& \diag(Y_{tf})C_f + \diag(Y_{tt})C_t
\end{eqnarray}
and the
$n_b \times n_b$ nodal admittance matrix is
\begin{eqnarray}
Y_{bus}& =& C_f^\mathsf{T} Y_f + C_t^\mathsf{T} Y_t .
\end{eqnarray}
% and it relates the complex bus voltages to the nodal current injections
% \begin{eqnarray}
% I_{bus}& =& Y_{bus}V
% \end{eqnarray}
% The complex bus power injections are expressed as a non-linear function of $V$
% \begin{eqnarray}
% S_{bus}(V)& =& \diag(V)I_{bus}^* \nonumber \\
% \label{eq:sbus}
% &= & \diag(V)Y_{bus}^*V^*
% \end{eqnarray}
% The net complex power injection (generation - load) at each bus must equal the
% sum of complex power flows on each branch connected to the bus.  Hence the AC
% power balance equations are
% \begin{equation}
% \label{eq:mismatch}
% S_{bus}(V) + S_d - S_g = 0
% \end{equation}

\paragraph{Power Balance}
% Importantly, the relationship between nodal voltages and power entering the
% network is non-linear.
For a network of $n_b$ nodes, the current injected at
node $i$ is
\begin{equation}
I_i = \sum_{j=1}^{n_b} Y_{ij} V_j
\end{equation}
where $Y_{ij} = \vert Y_{ij}\vert \angle\theta_{ij}$ is the $(i,j)^{th}$ element
if the $Y_{bus}$ matrix.  Hence, the apparent power entering
the network at bus $i$ is
\begin{equation}
S_i = P_i+Q_i = V_iI_i^* = \sum_{n=1}^{n_b} \vert Y_{ij}V_iV_j \vert \angle
(\delta_i - \delta_j - \theta_{ij})
\end{equation}
Converting to polar coordinates and separating the real and imaginary parts,
the active power
\begin{equation}
P_i = \sum_{n=1}^{n_b} \vert Y_{ij}V_iV_j \vert \cos(\delta_i - \delta_j -
\theta_{ij})
\end{equation}
and the reactive power entering the network
\begin{equation}
Q_i = \sum_{n=1}^{n_b} \vert Y_{ij}V_iV_j \vert \sin(\delta_i - \delta_j -
\theta_{ij})
\end{equation}
at bus $i$ are non-linear functions of $V_i$, as indicated by the presence of
the sine and cosine terms.  Kirchoff's Current Law requires that the net
complex power injection (generation - load) at each bus equals the sum of
complex power flows on each branch connected to the bus.  The power balance
equations
\begin{equation}
\label{eq:p_balance}
P_g^i - P_d^i = P^i
\end{equation}
and
\begin{equation}
\label{eq:q_balance}
Q_g^i - Q_d^i = Q^i
\end{equation}
where the subscripts $g$ and $d$ indicate generation and demand
respectively, form a key non-linear constraint in the optimal power flow
problem.

\subsubsection{Optimal Power Flow Formulation}
Optimal power flow is a mathematical optimisation problem in which the complex
power balance equations (\ref{eq:p_balance}) and (\ref{eq:q_balance}) form one
of the constraints. Mathematical optimisation problems have the general form
\begin{equation}
\min_x f(x)
\end{equation}
subject to
\begin{eqnarray}
\label{eq:equality}
g(x)& =& 0\\
\label{eq:inequality}
h(x)& \leq& 0
\end{eqnarray}
where $x$ is the optimisation variable, $f$ is the objective function and
equations (\ref{eq:equality}) and (\ref{eq:inequality}) are sets of equality
and inequality constraints on $x$, respectively.  Typical inequality
constraints are bus voltage magnitude contingency state limits, generator
output limits and branch power or current flow limits.  The optimisation
variable $x$ may be made up of generator set-points, bus voltages, transformer
tap settings etc.  If the optimisation variable $x$ is empty then the
formulation reduces to the general power flow problem described in above.

A common objective of optimal power flow is total system cost minimisation.
For and network of $n_g$ generators the objective function is
\begin{equation}
\label{eq:objfunc}
\min_{\theta, V_m, P_g} \sum_{k=1}^{n_g} C^k_P(P_g^k) + C_Q^k(Q_g^k)
\end{equation}
where $C_P^k$ and $C_Q^k$ are cost functions (typically quadratic) of the
set-points $P_g^k$ and $Q_g^k$ for generator $k$, respectively. Alternative
objectives may be to minimise losses, maximise the voltage stability margin or
minimise deviation of an optimisation variable from a particular schedule
\cite[\S18]{kallrath:2009}.

\subsubsection{Nodal Marginal Prices}
Many solution methods for optimal power flow have been developed
since Carpentier introduced the problem and a review of the main techniques
can be found in \citeA{momoh:part1,momoh:part2}.  One of the most robust
strategies is to solve the Lagrangian function
\begin{equation}
\mathcal{L}(x) = f(x) + \lambda^\mathsf{T}g(x) + \mu^\mathsf{T}h(x),
\end{equation}
where $\lambda$ and $\mu$ are the Lagrangian multipliers, using an Interior
Point Method.  When solved, the Lagrangian multiplier for a constraint gives
the rate of change of the objective function value with respect to the
constraint variable.  If the objective function is equation (\ref{eq:objfunc}), the Lagrangian
multipliers $\lambda^i_P$ and $\lambda^i_Q$ for the power balance constraint at
each bus $i$, given by equations (\ref{eq:p_balance}) and (\ref{eq:q_balance}),
are the nodal marginal prices and can be interpreted as the increase in the
total system cost for and additional injection at $i$ of 1MW or 1MVAr,
respectively.  For a case in which none of the inequality constraints $h(x)$
(such as branch power flow or bus voltage limits) are binding, the nodal
marginal prices are uniform across all buses and equal the cost of the
marginal generating unit.  When the constraints \textit{are} binding, the nodal
marginal prices are elevated for buses at which adjustments to power injection
are required for the constraints to be satisfied.  Nodal marginal prices are
commonly used in agent-based electricity market simulation to determine the
revenue for generating units as they reflect the increased value of production in
constrained areas of the power system.

\subsection{Agent-Based Simulation}
Social systems, such as electricity markets, are inherently complex and involve
interactions between different types of individuals and between individuals
and collective entities, such as organisations or groups, the behaviour of which
is itself the product of individual interactions.  This complexity
drives classical monolithic equilibrium models to their limits.  Models are
often highly stylised and limited to small numbers of players with strong
constraining assumptions made on their behaviour.

Agent-based simulation involves modelling simultaneous operations and
interactions between adaptive agents and assessing their effect on the system
as a whole.  Macro-level system properties arise from agent interactions, even
those with simple behavioural rules, that could not be deduced by simply
aggregating the agent's properties. % Game of Life

Following \citeA{tesfatsi:handbook}, the objectives of agent-based modelling
research fall roughly into four strands: empirical, normative, heuristic and
methodological. The \textit{empirical} objectives are to understand how and why macro-level
regularities have evolved from micro-level interactions when little or no
top-down control is present.  Research with the \textit{normative} goals aims
to relate agent-based models to an ideal standard or optimal design.  The objective being
to evaluate proposed designs for social policy, institutions or processes in
their ability to produce socially desirable system performance.  The
\textit{heuristic} strand aims to generate theories on the fundamental causal
mechanisms in social systems that can be observed, even in simple systems, when there are
alternative initial conditions.  This thesis aims to provide
\textit{methodological} advancement.  Improvements in the tools and methods
available aid research with the former objectives.

%\section{Summary}
