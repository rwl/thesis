\begin{figure}
\label{fig:ieee30}
\centering
\begin{tikzpicture}[thick]

\coordinate (c1) at (0, 16);
\coordinate (c2) at (2, 16);
\coordinate (c3) at (0, 13);
\coordinate (c4) at (2, 13);
\coordinate (c5) at (4, 16);
\coordinate (c6) at (5, 13);
\coordinate (c7) at (6, 16);
\coordinate (c8) at (7.5, 13);
\coordinate (c9) at (7, 11.5);
\coordinate (c10) at (7, 10);
\coordinate (c11) at (9.5, 12);
\coordinate (c12) at (1.5, 10);
\coordinate (c13) at (-1, 10);
\coordinate (c14) at (-1, 6);
\coordinate (c15) at (0, 5);
\coordinate (c16) at (4, 10);
\coordinate (c17) at (5, 9);
\coordinate (c18) at (3, 7.5);
\coordinate (c19) at (4, 5);
\coordinate (c20) at (5, 7);
\coordinate (c21) at (8, 8);
\coordinate (c22) at (7, 7);
\coordinate (c23) at (1, 2);
\coordinate (c24) at (5, 2);
\coordinate (c25) at (7, 2);
\coordinate (c26) at (8, 0);
\coordinate (c27) at (10, 8);
\coordinate (c28) at (10, 15);
\coordinate (c29) at (9, 1);
\coordinate (c30) at (10, 3);

\busbar{b1}{c1}{10mm}
\busbar{b2}{c2}{20mm}
\busbar{b3}{c3}{15mm}
\busbar{b4}{c4}{15mm}
\busbar{b5}{c5}{15mm}
\busbar{b6}{c6}{25mm}
\busbar{b7}{c7}{15mm}
\busbar{b8}{c8}{15mm}
\busbar{b9}{c9}{15mm}
\busbar{b10}{c10}{25mm}
\busbar{b11}{c11}{15mm}
\busbar{b12}{c12}{25mm}
\busbar{b13}{c13}{15mm}
\busbar{b14}{c14}{15mm}
\busbar{b15}{c15}{20mm}
\busbar{b16}{c16}{15mm}
\busbar{b17}{c17}{15mm}
\busbar{b18}{c18}{15mm}
\busbar{b19}{c19}{15mm}
\busbar{b20}{c20}{15mm}
\busbar{b21}{c21}{10mm}
\busbar{b22}{c22}{15mm}
\busbar{b23}{c23}{15mm}
\busbar{b24}{c24}{15mm}
\busbar{b25}{c25}{15mm}
\busbar{b26}{c26}{15mm}
\busbar{b27}{c27}{20mm}
\busbar{b28}{c28}{15mm}
\busbar{b29}{c29}{15mm}
\busbar{b30}{c30}{15mm}

% Branch 1-2.
\draw[line] ([xshift=2mm] b1.south) -- ++(0,-5mm) -| ([xshift=-8mm] b2.south);
% Branch 1-3.
\draw[line] ([xshift=-2mm] b1.south) -- ([xshift=-2mm] b3.north);
% Branch 2-4.
\draw[line] ([xshift=0mm] b2.south) -- (b4.north);
% Branch 3-4.
\draw[line] ([xshift=2mm] b3.north) -- ++(0,5mm) -| ([xshift=-5mm] b4.north);
% Branch 2-5.
\draw[line] ([xshift=8mm] b2.south) -- ++(0,-5mm) -| ([xshift=-5mm] b5.south);
% Branch 2-6.
\draw[line] ([xshift=5mm] b2.south) -- ++(0,-14mm) -| ([xshift=-5mm] b6.north);
% Branch 4-6.
\draw[line] ([xshift=5mm] b4.north) -- ++(0,5mm) -| ([xshift=-10mm] b6.north);
% Branch 5-7.
\draw[line] ([xshift=5mm] b5.south) -- ++(0,-5mm) -| ([xshift=-5mm] b7.south);
% Branch 6-7.
\draw[line] ([xshift=0mm] b6.north) -- ++(0,15mm) -| ([xshift=0mm] b7.south);
% Branch 6-8.
\draw[line] ([xshift=8mm] b6.south) -- ++(0,-5mm) -| ([xshift=-4mm] b8.south);
% Branch 6-9.
\draw[line] (b6.south) -- ++(0,-10mm) -| (b9.north);
% Branch 6-10.
\draw[line] ([xshift=-5mm] b6.south) -- ++(0,-20mm) -| ([xshift=-5mm]
b10.north);
% Branch 9-11.
\draw[line] ([xshift=2mm] b9.south) -- ++(0,-5mm) -| (b11);
% Branch 9-10.
\draw[line] (b9.south) -- (b10.north);
% Branch 4-12.
\draw[line] ([xshift=-2mm] b4.south) -- ([xshift=3mm] b12.north);
% Branch 12-13.
\draw[line] ([xshift=-10mm] b12.south) -- ++(0,-5mm) -| (b13.south);
% Branch 12-14.
\draw[line] ([xshift=-5mm] b12.south) -- ++(0,-20mm) -| (b14.north);
% Branch 12-15.
\draw[line] (b12.south) -- ++(0,-30mm) -| (b15.north);
% Branch 12-16.
\draw[line] ([xshift=10mm] b12.north) -- ++(0,5mm) -| ([xshift=-2mm]
b16.north);
% Branch 14-15.
\draw[line] ([xshift=2mm] b14.south) -- ++(0,-5mm) -| ([xshift=-2mm] b15.north);
% Branch 16-17.
\draw[line] ([xshift=5mm] b16.south) -- ([xshift=-5mm] b17.north);
% Branch 15-18.
\draw[line] ([xshift=5mm] b15.north) -- ++(0,10mm) -| ([xshift=-5mm] b18.south);
% Branch 18-19.
\draw[line] ([xshift=5mm] b18.south) -- ([xshift=-5mm] b19.north);
% Branch 19-20. TODO: Check!
% Branch 10-20.
\draw[line] (b10.south) -- ++(0,-15mm) -| ([xshift=2mm] b20.north);
% Branch 10-17.
\draw[line] ([xshift=-5mm] b10.south) -- ++(0,-5mm) -| ([xshift=2mm] b17.north);
% Branch 10-21.
\draw[line] ([xshift=8mm] b10.south) -- ([xshift=-2mm] b21.north);
% Branch 10-22.
\draw[line] ([xshift=4mm] b10.south) -- ++(0,-18mm) -| ([xshift=-2mm]
b22.north);
% Branch 21-22.
\draw[line] (b21.south) -- ++(0,-5mm) -| ([xshift=5mm] b22.north);
% Branch 15-23.
\draw[line] ([xshift=5mm] b15.south) -- ([xshift=-5mm] b23.north);
% Branch 22-24. TODO: Check!
\draw[line] ([xshift=-2mm] b22.south) -- ++(0,-30mm) -| (b24.north);
% Branch 23-24.
\draw[line] ([xshift=2mm] b23.south) -- ++(0,-5mm) -| ([xshift=-5mm] b24.south);
% Branch 24-25.
\draw[line] ([xshift=5mm] b24.south) -- ++(0,-5mm) -| (b25.south);
% Branch 25-26.
\draw[line] ([xshift=5mm] b25.south) -- ([xshift=-5mm] b26.north);
% Branch 25-27.
\draw[line] ([xshift=2mm] b25.north) -- ++(0,10mm) --
([xshift=-5mm,yshift=-10mm] b27.south) -- ([xshift=-5mm] b27.south);
% Branch 28-27.
\draw[line] ([xshift=5mm] b28.south) -- ([xshift=5mm] b27.north);
% Branch 27-29.
\draw[line] (b27.south) -- ++(0,-35mm) -| ([xshift=-2mm] b29.north);
% Branch 27-30.
\draw[line] ([xshift=4mm] b27.south) -- ([xshift=4mm] b30.north);
% Branch 29-30.
\draw[line] ([xshift=4mm] b29.north) -- ++(0,10mm) -| (b30.south);
% Branch 8-28.
\draw[line] (b8.north) -- ++(0,8mm) -| (b28.south);
% Branch 6-28.
\draw[line] ([xshift=8mm] b6.north) -- ++(0,12mm) -| ([xshift=-5mm] b28.south);

% Generator 1 @ Bus 1.
\sgen{g1}{$(c1)+(0mm,8mm)$}
\draw[line] (b1.north) -- (g1.south);
% Generator 2 @ Bus 2.
\sgen{g2}{$(c2)+(0mm,8mm)$}
\draw[line] (b2.north) -- (g2.south);
% Generator 3 @ Bus 22.
\sgen{g3}{$(c22)+(5mm,-8mm)$}
\draw[line] ([xshift=5mm] b22.south) -- (g3.north);
% Generator 4 @ Bus 27.
\sgen{g4}{$(c27)+(-5mm,8mm)$}
\draw[line] ([xshift=-5mm] b27.north) -- (g4.south);
% Generator 5 @ Bus 23.
\sgen{g5}{$(c23)+(5mm,8mm)$}
\draw[line] ([xshift=5mm] b23.north) -- (g5.south);
% Generator 6 @ Bus 13.
\sgen{g6}{$(c13)+(0mm,8mm)$}
\draw[line] ([xshift=0mm] b13.north) -- (g6.south);

% Load @ Bus 2.
%\sload{l1}{$(c2)-(5mm,8mm)$}
%\draw[line] (l1.south) -- ([xshift=-5mm] b2.south);
\draw[loadline] ([xshift=-5mm] b2.south) -- ++(0,-1);
% Load @ Bus 3.
% \sload{l2}{$(c3)-(0mm,8mm)$}
% \draw[line] (l2.south) -- (b3.south);
\draw[loadline] (b3.south) -- ++(0,-1);
% Load @ Bus 4.
% \sload{l3}{$(c4)-(-5mm,8mm)$}
% \draw[line] (l3.south) -- ([xshift=5mm] b4.south);
\draw[loadline] ([xshift=5mm] b4.south) -- ++(0,-1);
% Load @ Bus 7.
% \sload{l4}{$(c7)-(-5mm,8mm)$}
% \draw[line] (l4.south) -- ([xshift=5mm] b7.south);
\draw[loadline] ([xshift=5mm] b7.south) -- ++(0,-1);
% Load @ Bus 8.
% \sload{l5}{$(c8)-(-5mm,8mm)$}
% \draw[line] (l5.south) -- ([xshift=5mm] b8.south);
\draw[loadline] ([xshift=5mm] b8.south) -- ++(0,-1);
% Load @ Bus 10.
% \sload{l6}{$(c10)-(-10mm,8mm)$}
% \draw[line] (l6.south) -- ([xshift=10mm] b10.south);
\draw[loadline] ([xshift=10mm] b10.south) -- ++(0,-1);
% Load @ Bus 12.
% \sload{l7}{$(c12)-(-5mm,8mm)$}
% \draw[line] (l7.south) -- ([xshift=5mm] b12.south);
\draw[loadline] ([xshift=5mm] b12.south) -- ++(0,-1);
% Load @ Bus 14.
% \sload{l8}{$(c14)-(5mm,8mm)$}
% \draw[line] (l8.south) -- ([xshift=-5mm] b14.south);
\draw[loadline] ([xshift=-5mm] b14.south) -- ++(0,-1);
% Load @ Bus 15.
% \sload{l9}{$(c15)-(5mm,8mm)$}
% \draw[line] (l9.south) -- ([xshift=-5mm] b15.south);
\draw[loadline] ([xshift=-5mm] b15.south) -- ++(0,-1);
% Load @ Bus 16.
% \sload{l10}{$(c16)-(5mm,8mm)$}
% \draw[line] (l10.south) -- ([xshift=-5mm] b16.south);
\draw[loadline] ([xshift=-5mm] b16.south) -- ++(0,-1);
% Load @ Bus 17.
% \sload{l11}{$(c17)-(5mm,8mm)$}
% \draw[line] (l11.south) -- ([xshift=-5mm] b17.south);
\draw[loadline] ([xshift=-5mm] b17.south) -- ++(0,-1);
% Load @ Bus 18.
% \sload{l12}{$(c18)-(0mm,8mm)$}
% \draw[line] (l12.south) -- ([xshift=0mm] b18.south);
\draw[loadline] ([xshift=0mm] b18.south) -- ++(0,-1);
% Load @ Bus 19.
% \sload{l13}{$(c19)-(-0mm,8mm)$}
% \draw[line] (l13.south) -- (b19.south);
\draw[loadline] (b19.south) -- ++(0,-1);
% Load @ Bus 20.
% \sload{l14}{$(c20)-(0mm,8mm)$}
% \draw[line] (l14.south) -- ([xshift=0mm] b20.south);
\draw[loadline] ([xshift=0mm] b20.south) -- ++(0,-1);
% Load @ Bus 21.
% \sload{l15}{$(c21)-(-2mm,8mm)$}
% \draw[line] (l15.south) -- ([xshift=2mm] b21.south);
\draw[loadline] ([xshift=2mm] b21.south) -- ++(0,-1);
% Load @ Bus 23.
% \sload{l16}{$(c23)-(2mm,8mm)$}
% \draw[line] (l16.south) -- ([xshift=-2mm] b23.south);
\draw[loadline] ([xshift=-2mm] b23.south) -- ++(0,-1);
% Load @ Bus 24.
% \sload{l17}{$(c24)-(0mm,8mm)$}
% \draw[line] (l17.south) -- ([xshift=0mm] b24.south);
\draw[loadline] ([xshift=0mm] b24.south) -- ++(0,-1);
% Load @ Bus 26.
% \sload{l18}{$(c26)-(0mm,8mm)$}
% \draw[line] (l18.south) -- ([xshift=0mm] b26.south);
\draw[loadline] ([xshift=0mm] b26.south) -- ++(0,-1);
% Load @ Bus 29.
% \sload{l19}{$(c29)-(-4mm,8mm)$}
% \draw[line] (l19.south) -- ([xshift=4mm] b29.south);
\draw[loadline] ([xshift=4mm] b29.south) -- ++(0,-1);
% Load @ Bus 30.
% \sload{l20}{$(c30)-(-4mm,8mm)$}
% \draw[line] (l20.south) -- ([xshift=4mm] b30.south);
\draw[loadline] ([xshift=4mm] b30.south) -- ++(0,-1);

\end{tikzpicture}
\caption{One line diagram for IEEE 30 bus test system.}
\end{figure}
